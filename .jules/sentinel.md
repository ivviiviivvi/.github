## 2025-12-18 - TOCTOU SSRF Vulnerability Fix in Web Crawler
**Vulnerability:** A Time-of-Check Time-of-Use (TOCTOU) vulnerability existed in `scripts/web_crawler.py`. The script checked if a hostname resolved to a safe IP using `_is_safe_url` but then allowed `requests` to re-resolve the hostname during the connection, allowing DNS rebinding attacks to bypass the check.
**Learning:** Checking a hostname before a request is insufficient for SSRF protection because the DNS record can change between the check and the use.
**Prevention:** Resolve the hostname to an IP address first, validate the IP, and then force the HTTP client to connect to that specific IP address (e.g., by rewriting the URL) while setting the `Host` header to the original hostname. Note that for HTTPS, this often requires disabling hostname verification (`verify=False`) if the client library doesn't support SNI with custom connection endpoints easily, which is a security trade-off.